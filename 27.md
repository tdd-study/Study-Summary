## 27장 테스팅 패턴

### 자식 테스트

> 지나치게 큰 테스트 케이스를 어떻게 돌아가도록 할 수 있을까?

작은 테스트 케이스를 작성하고 작은 TC가 실행되도록 한다. 그 후에 다시 원래의 큰 TC를 추가한다

TDD는 빨강/초록/리팩토링(파랑) 리듬을 가지고 이 리듬을 유지하는 것은 매우 중요하다 이 리듬이 깨지려고 한다면 작은 것부터 해보자

### 모의 객체

> 모의 객체(Mock Object)란 주로 객체 지향 프로그래밍으로 개발한 프로그램을 테스트 할 경우  
테스트를 수행할 모듈과 연결되는 외부의 다른 서비스나 모듈들을 실제 사용하는 모듈을 사용하지 않고  
실제의 모듈을 "흉내"내는 "가짜" 모듈을 작성하여 테스트의 효용성을 높이는데 사용하는 객체이다.  
사용자 인터페이스(UI)나 데이터베이스 테스트 등과 같이 자동화된 테스트를 수행하기 어려운 때 널리 사용된다.  
(https://ko.wikipedia.org/wiki/%EB%AA%A8%EC%9D%98_%EA%B0%9D%EC%B2%B4)  


비용이 많이 들거나 복잡한 리소스에 의존하는 객체를 테스트하려면 어떻게 해야할까?

고전적인 예는 데이터베이스다 실제 데이터베이스를 사용하면 개발 중 많은 오류의 원인이 된다  
메모리에만 존재하는 객체를 만들어서 테스트해보자

모의 객체를 사용함으로써 성능, 견고함, 가독성을 얻을 수 있다

```swift
func testOrderLookup() {
  // MockDatabase 는 예상된 쿼리를 얻지 못하면 예외를 던질 것이다
  let db = MockDatabase()
  db.expectQuery("select order_no from Order where cust_no is 123")
  db.returnResult(["Order 2", "Order 3"])
  ...
}
```

### 셀프 션트

> 한 객체가 다른 객체와 올바르게 대화하는지 테스트하려면 어떻게 해야 할까?

테스트 대상이 되는 객체가 원래의 대화 상대가 아니라 TC와 대화하도록 만들면 된다

### 로그 문자열

> 메시지의 호출 순서가 올바른지를 검사하려면 어떻게 해야 할까?

로그 문자열을 가지고 있다가 메시지가 호출될 때마다 그 문자열에 추가하도록 한다  
로그 문자열은 특히 옵저버를 구현하고, 이벤트 통보가 원하는 순서대로 발생하는 지를 확인하고자 할 때 유용하다

### 크래시 테스트 더미

> 호출되지 않을 것 같은 에러코드(발생하기 힘든 에러 상황)를 어떻게 테스트할 것인가?

실제 작업을 수행하는 대신 그냥 예외를 발생시키기만 하는 특수한 객체를 만들어서 이를 호출한다 작동하길 원하는 부분에 대해서만 테스트해 본다

ex) 파일 시스템에 여유 공간이 없을 경우 발생할 문제에 대해 테스트  
ex2) 자판기에서 잘못된 동전을 넣었을 때 발생할 문제에 대해 테스트 (다른 나라 동전이라던지) 가 생각났다

### 깨진 테스트

> 혼자서 프로그래밍할 때는 마지막 테스트가 깨진 상태로 끝마치는 것이 좋다

### 깨끗한 체크인

> 팀 프로그래밍할 때는 모든 테스트가 성공한 상태로 끝마치는 것이 좋다
